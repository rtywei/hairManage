<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Basic Layout - jQuery EasyUI Demo</title>
<link rel="stylesheet" type="text/css"
	th:href="@{/themes/default/easyui.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/themes/icon.css}" />
<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.easyui.min.js}"></script>
<script type="text/javascript" th:src="@{/js/easyui-lang-zh_CN.js}"></script>
<script type="text/javascript">
		var toolbar = [ {
			id : 'button-add',
			text : '增加',
			iconCls : 'icon-add',
			handler : add
		},{
			id : 'button-add',
			text : '修改',
			iconCls : 'icon-save',
			handler : update
		},{
			id : 'button-view',
			text : '查询',
			iconCls : 'icon-search',
			handler : search
		}]
		var columns = [[{
			field : 'id',
			checkbox : true
		},{
			field : 'username',
			title : '客户姓名',
			width : 120,
			align : 'center',
			formatter : function(data,row) {
				return row.user.username
			}
		},{
			field : 'flag',
			title : '类型',
			width : 120,
			align : 'center',
			formatter : function(data, row, index) {
				if(data == 0) {
					return "充值";
				} else {
					return "消费";
				}
			}
		},{
			field : 'money',
			title : '金额',
			width : 120,
			align : 'center'
		},{
			field : 'date',
			title : '日期',
			width : 120,
			align : 'center',
			formatter : function(data, row, index) {
				return data;
			}
		},{
			field : 'description',
			title : '内容描述',
			width : 120,
			align : 'center'
		}]]
		$(function(){
			$('#account_add').window({
				collapsible:false,
				minimizable:false,
				maximizable:false,
				titil:"添加",
				model:true,
				shadow:true,
				tools:[{
					iconCls:'icon-add',
					handler:function(){
						var v = $("#accountForm").form("validate");
						if(v == false) {
							return;
						}
						$("#accountForm").submit();
					}
				}]
			});
			
			$('#account_update').window({
				collapsible:false,
				minimizable:false,
				maximizable:false,
				titil:"修改",
				model:true,
				shadow:true,
				tools:[{
					iconCls:'icon-save',
					handler:function(){
						var v = $("#updateForm").form("validate");
						if(v == false) {
							return;
						}
						$("#updateForm").submit();
					}
				}]
			});
			
			$('#tt').datagrid({
				iconCls : 'icon-forward',
				fit : true,
				border : false,
				rownumber : true,
				striped : true,
				pagination : true,
				toolbar : toolbar,
				columns : columns,
				pagination : true,
				url : "/account/findAll",
				fitColumns:"true",
				onDblClickRow : function(rowIndex,rowData){
					$("#account_update").window("open");
					$("#updateForm").form("load",rowData);
				}
			})
			
			$('#ss').searchbox({
			    searcher:function(value,name){
			    	$('#tt').datagrid({
						iconCls : 'icon-forward',
						fit : true,
						border : false,
						rownumber : true,
						striped : true,
						pagination : true,
						toolbar : toolbar,
						columns : columns,
						url : "/account/findByCondition?" +  name + "=" + value,
						fitColumns:"true",
						onDblClickRow : function(rowIndex,rowData){
							$("#account_update").window("open");
							$("#updateForm").form("load",rowData);
						}
					})
			    },
			    menu:'#mm',
			    prompt:'请输入查询信息'
			});
			$.extend($.fn.validatebox.defaults.rules, {
				phone: {
					validator: function(value,param) {
						var phoneRex =/^1[3|4|5|8][0-9]{9}/; 
						return phoneRex.test(value);
					},
					message : '手机号输入有错误'
				}
			});
			
			$("")
		});
		
		function add() {
			$("#account_add").window("open");
		}
		function update() {
			$("#account_update").window("open");
			var row = $("#tt").datagrid('getSelected');
			$("#updateForm").form("load",row);
		}
		function search() {
			var row = $("#tt").datagrid('getSelected');
			window.location.href = "/account/findAll?userId="+row.id;
		}
	</script>
</head>
<body class="easyui-layout">

	<h2>客户管理系统</h2>
	<p></p>
	<div style="margin: 20px 0;"></div>
	<div class="easyui-layout" style="height: 650px;">
		<div data-options="region:'north'" style="height: 50px"></div>
		<div data-options="region:'east',split:true" title="East"
			style="width: 200px;"></div>
		<div data-options="region:'west',split:true" title="West"
			style="width: 200px;">
			<div>
				<ul id="tree" class="easyui-tree">
				    <li>
						<a class="acicon" th:href="@{/}">客户信息</a>
					</li>
				    <li>
				    	<a class="acicon" th:href="@{/consume}">消费信息</a>
				    </li>
				</ul>
			</div>
		</div>
		
		<div data-options="region:'center',title:'消费信息',iconCls:'icon-ok'">
			<div>
				<input id="ss" style="width:250px"></input>
				<div id="mm" style="width:100px">
				    <div data-options="name:'phone',iconCls:'icon-ok'" style="width:100px">手机号查询</div>
				    <div data-options="name:'username'" style="width:100px">姓名查询</div>
				</div>
				<div style="height:548px">
					<table id="tt" ></table>
				</div>
			</div>
		</div>
		
		<div id="account_add" class="easyui-window" title="添加账户" closed="true" style="width:500px;height:300px;padding:5px;">
			<form id="accountForm" action="/account/add" method="post">
				<div style="position:relative;left:120px;top:50px">
					客户姓名<input type="text" name="username" class="easyui-validatebox" placeholder="请输入姓名" required="true"/><br/><br/>
					性别<input type="radio" name="sex" value="0"/>男 <input type="radio" name="sex" value="1"/>女<br/><br/>
					手机号<input type="text" name="phone" class="easyui-validatebox" validType="phone" placeholder="请输入手机号" required="true"/>
				</div>
			</form>
		</div>
		
		<div id="account_update" class="easyui-window" title="修改账户" closed="true" style="width:500px;height:300px;padding:5px;">
			<form id="updateForm" action="/account/update" method="post">
			<div style="position:relative;left:120px;top:50px">
				<input type='hidden' name='id'/>
					客户姓名<input type="text" name="username" placeholder="请输入姓名"/><br/><br/>
					性别<input type="radio" name="sex" value="0"/>男 <input type="radio" name="sex" value="1"/>女<br/><br/>
					手机号<input type="text" name="phone" placeholder="请输入手机号"/>
				</div>
			</form>
		</div>
	</div>
</body>
</html>